package com.xelitexirish.malwareshield;

import android.content.Context;
import android.os.AsyncTask;

import java.io.IOException;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.ArrayList;
import java.util.List;
import java.util.Scanner;

public class ListHelper {

    private static List<String> BANNED_URLS = new ArrayList<>();
    private static String URL_BANNED_URL_LIST = "https://hexxiumcreations.github.io/threat-list/hexxiumthreatlist.txt";

    public static void initList(Context context) {
        if (BANNED_URLS.isEmpty()) {
            new FillListTask().execute();
        }
    }

    public static List getBannedUrls() {
        return BANNED_URLS;
    }

    public static class FillListTask extends AsyncTask<Void, Void, Void> {

        @Override
        protected Void doInBackground(Void... params) {

            try {
                Scanner scanner = new Scanner(new URL(URL_BANNED_URL_LIST).openStream());
                while (scanner.hasNextLine()) {
                    String line = scanner.nextLine();
                    if(line.startsWith("||")) {
                        BANNED_URLS.add(line.substring(2));
                    }
                }

            } catch (MalformedURLException e) {
                e.printStackTrace();
            } catch (IOException e) {
                e.printStackTrace();
            }

            return null;
        }
    }
}
